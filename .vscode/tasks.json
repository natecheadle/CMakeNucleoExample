{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Create Output Directory",
            "type": "shell",
            "command": "mkdir -p ${workspaceRoot}/build/${input:BUILD_TARGET}/${input:BUILD_TYPE}"
        },
        {
            "label": "Generate CMake Cache",
            "type": "shell",
            "group": "build",
            "command": "cmake -DCMAKE_TOOLCHAIN_FILE=../../../arm-none-eabi-gcc.cmake -DSTM32_PLATFORM:STRING=${input:BUILD_TARGET} -DCMAKE_BUILD_TYPE=${input:BUILD_TYPE} ../../..",
            "problemMatcher": [
                "$gcc"
            ],
            "options": {
                "cwd": "${workspaceRoot}/build/${input:BUILD_TARGET}/${input:BUILD_TYPE}"
            },
            "dependsOn": "Create Output Directory"
        },
        {
            "label": "Build Target",
            "type": "shell",
            "group": "build",
            "command": "cmake --build . -- -j 4",
            "problemMatcher": [
                "$gcc"
            ],
            "options": {
                "cwd": "${workspaceRoot}/build/${input:BUILD_TARGET}/${input:BUILD_TYPE}"
            },
            "dependsOn": "Generate CMake Cache"
        },
        {
            "label": "Clean Output",
            "type": "shell",
            "group": "build",
            "command": "rm -rf ${workspaceRoot}/build/${input:BUILD_TARGET}/${input:BUILD_TYPE}"
        },
        {
            "label": "Rebuild Target",
            "type": "shell",
            "dependsOrder": "sequence",
            "dependsOn": [
                "Clean Output",
                "Build Target"
            ]
        },
        {
            "label": "Flash Target",
            "type": "shell",
            "command": "/Users/Nate/Applications/STM32/Programmer/STM32CubeProgrammer.app/Contents/MacOs/bin/STM32_Programmer_CLI -c port=SWD freq=4000 -w ${workspaceRoot}/build/${input:BUILD_TARGET}/${input:BUILD_TYPE}/NUCLEO-${input:BUILD_TARGET}.bin 0x8000000",
            "dependsOn": "Build Target"
        },
        {
            "label": "Flash and Restart Target",
            "type": "shell",
            "command": "/Users/Nate/Applications/STM32/Programmer/STM32CubeProgrammer.app/Contents/MacOs/bin/STM32_Programmer_CLI -c port=SWD freq=4000 -rst",
            "dependsOn": "Flash Target"
        }
    ],
    "inputs": [
        {
          "id": "BUILD_TYPE",
          "type": "pickString",
          "description": "Build for Debug or Release",
          "options": [
              "DEBUG",
              "RELEASE"
          ]
        },
        {
            "id": "BUILD_TARGET",
            "type": "pickString",
            "description": "Build Target (ex. F303RE)",
            "options": [
                "STM32F3xx",
                "STM32F301x8",
                "STM32F302x8",
                "STM32F302xC",
                "STM32F302xE",
                "STM32F303xE",
                "STM32F318xx",
                "STM32F328xx",
                "STM32F334x8",
                "STM32F358xx",
                "STM32F373xC",
                "STM32F378xx",
                "STM32F398xx"
            ]
        }
    ]
}